<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="21:9 Clock">
    <link rel="manifest" id="manifest-placeholder">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23f4f4f4'/%3E%3Ccircle cx='256' cy='256' r='200' fill='none' stroke='%231a1a1a' stroke-width='40'/%3E%3Cline x1='256' y1='256' x2='256' y2='100' stroke='%231a1a1a' stroke-width='30' stroke-linecap='round'/%3E%3Cline x1='256' y1='256' x2='380' y2='256' stroke='%23666666' stroke-width='20' stroke-linecap='round'/%3E%3Ccircle cx='256' cy='256' r='20' fill='%231a1a1a'/%3E%3C/svg%3E">
    
    <title>Monotone Clock & Weather</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&family=Noto+Sans+JP:wght@400;700&display=swap');

        :root {
            --bg-base: #f4f4f4;
            --bg-gradient: #ffffff;
            --ink-black: #1a1a1a;
            --slate-gray: #666666;
            --soft-gray: #e0e0e0;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--bg-base);
            background: radial-gradient(circle at center, var(--bg-gradient) 0%, var(--bg-base) 100%);
            color: var(--ink-black);
            font-family: 'Poppins', 'Noto Sans JP', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }

        .main-layout {
            display: flex;
            width: 90vw;
            height: 100vh;
            margin: 0 auto;
            align-items: center;
            justify-content: space-between;
        }

        /* --- 左側：時計エリア (60%) --- */
        .clock-container {
            width: 60%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            position: relative;
            z-index: 10;
            animation: float 6s ease-in-out infinite;
        }

        .date-section {
            font-size: 2vw;
            font-weight: 300;
            letter-spacing: 0.15em;
            color: var(--slate-gray);
            margin-bottom: -1vh;
            display: flex;
            gap: 1vw;
            opacity: 0.9;
            padding-left: 0.5vw;
        }

        .day-highlight {
            font-weight: 600;
            color: var(--ink-black);
        }

        .time-wrapper {
            display: flex;
            align-items: baseline;
            line-height: 1;
            margin-top: 1vh;
        }

        .time-section {
            font-size: 16vw;
            font-weight: 800;
            letter-spacing: -0.04em;
            color: var(--ink-black);
            font-variant-numeric: tabular-nums;
            text-shadow: 0 10px 40px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
        }

        .separator {
            opacity: 0.15;
            margin: 0 0.4vw; 
            transform: translateY(-1.2vw);
        }

        .seconds {
            font-size: 6vw;
            font-weight: 600;
            color: var(--slate-gray);
            margin-left: 1.5vw;
            font-variant-numeric: tabular-nums;
            opacity: 0.8;
        }

        /* --- 右側：天気エリア (40%) --- */
        .weather-container {
            width: 35%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-left: 2vw;
            border-left: 2px solid rgba(0,0,0,0.05);
            color: var(--ink-black);
            animation: fadeIn 2s ease-out;
        }

        .weather-location {
            font-size: 1.2vw;
            letter-spacing: 0.2em;
            color: var(--slate-gray);
            margin-bottom: 2vh;
            text-transform: uppercase;
        }

        .weather-icon-box {
            width: 10vw;
            height: 10vw;
            margin-bottom: 1vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* アイコンのはみ出しを許容して影が切れないようにする */
            overflow: visible; 
        }
        
        .weather-svg {
            width: 100%;
            height: 100%;
            fill: var(--ink-black);
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
            /* はみ出し防止のため少しパディングを入れる */
            padding: 5%;
        }

        .weather-temp {
            display: flex;
            align-items: baseline;
            gap: 1.5vw;
            font-family: 'Poppins', sans-serif;
        }

        .temp-high {
            font-size: 5vw;
            font-weight: 800;
        }

        .temp-low {
            font-size: 3vw;
            font-weight: 600;
            color: var(--slate-gray);
            opacity: 0.7;
        }
        
        .weather-desc {
            font-family: 'Poppins', 'Noto Sans JP', sans-serif;
            font-size: 1.5vw;
            margin-top: 1vh;
            font-weight: 600;
            text-transform: capitalize;
        }

        .progress-bar-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--soft-gray);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #888888, #1a1a1a);
            width: 0%;
            border-radius: 0 4px 4px 0;
            transition: width 0.1s linear;
        }

        .hint-text {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--slate-gray);
            opacity: 0.3;
            transition: opacity 0.5s;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body onclick="toggleFullScreen()">

    <div id="hint" class="hint-text">TAP TO FULLSCREEN</div>

    <div class="main-layout">
        <div class="clock-container">
            <div class="date-section">
                <span id="date">LOADING</span>
                <span id="day" class="day-highlight"></span>
            </div>

            <div class="time-wrapper">
                <div class="time-section">
                    <span id="hours">00</span>
                    <span class="separator">:</span>
                    <span id="minutes">00</span>
                </div>
                <div class="seconds" id="seconds">00</div>
            </div>
        </div>

        <div class="weather-container">
            <div class="weather-location">SHIBATA, NIIGATA</div>
            <div class="weather-icon-box" id="weather-icon">
                <span style="font-size:2vw; opacity:0.5;">...</span>
            </div>
            <div class="weather-temp">
                <span class="temp-high" id="temp-max">--</span>
                <span class="temp-low" id="temp-min">--</span>
            </div>
            <div class="weather-desc" id="weather-text">Loading</div>
        </div>
    </div>

    <div class="progress-bar-container">
        <div class="progress-bar" id="progress"></div>
    </div>

    <script>
        function setupManifest() {
            const iconData = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23f4f4f4'/%3E%3Ccircle cx='256' cy='256' r='200' fill='none' stroke='%231a1a1a' stroke-width='40'/%3E%3Cline x1='256' y1='256' x2='256' y2='100' stroke='%231a1a1a' stroke-width='30' stroke-linecap='round'/%3E%3Cline x1='256' y1='256' x2='380' y2='256' stroke='%23666666' stroke-width='20' stroke-linecap='round'/%3E%3Ccircle cx='256' cy='256' r='20' fill='%231a1a1a'/%3E%3C/svg%3E";
            const manifest = {
                "name": "Monotone Clock",
                "short_name": "Clock",
                "start_url": ".",
                "display": "fullscreen",
                "background_color": "#f4f4f4",
                "theme_color": "#f4f4f4",
                "orientation": "landscape",
                "icons": [{ "src": iconData, "sizes": "512x512", "type": "image/svg+xml" }]
            };
            const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            document.querySelector('#manifest-placeholder').setAttribute('href', URL.createObjectURL(blob));
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e=>{});
                document.getElementById('hint').style.opacity = '0';
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }

        function updateClock() {
            const now = new Date();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const pad = (num) => String(num).padStart(2, '0');

            const year = now.getFullYear();
            const monthName = months[now.getMonth()];
            const date = pad(now.getDate());
            const dayName = days[now.getDay()];

            const h = pad(now.getHours());
            const m = pad(now.getMinutes());
            const s = pad(now.getSeconds());
            const progressPercent = ((now.getSeconds() + now.getMilliseconds() / 1000) / 60) * 100;

            document.getElementById('date').textContent = `${monthName} ${date}, ${year}`;
            document.getElementById('day').textContent = dayName;
            document.getElementById('hours').textContent = h;
            document.getElementById('minutes').textContent = m;
            document.getElementById('seconds').textContent = s;
            document.getElementById('progress').style.width = `${progressPercent}%`;
        }

        const API_URL = "https://api.open-meteo.com/v1/forecast?latitude=37.9485&longitude=139.3297&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo";

        /* 
           修正点: viewBoxをすべて "-10 -10 84 84" に広げて余白を作成。
           これにより、座標が多少マイナスにはみ出ても（Rainなど）、表示範囲内に収まります。
        */
        const viewboxSetting = "-10 -10 84 84";

        const icons = {
            sun: `<svg class="weather-svg" viewBox="${viewboxSetting}"><circle cx="32" cy="32" r="14" stroke="currentColor" stroke-width="4" fill="none"/><path d="M32 6V12 M32 52V58 M58 32H52 M12 32H6 M50.4 13.6L46.1 17.9 M17.9 46.1L13.6 50.4 M50.4 50.4L46.1 46.1 M17.9 17.9L13.6 13.6" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg>`,
            cloud: `<svg class="weather-svg" viewBox="${viewboxSetting}"><path d="M16 46H48C55.7 46 62 39.7 62 32C62 24.3 55.7 18 48 18C47.1 18 46.2 18.1 45.4 18.3C43.5 10.4 36.4 4.5 28 4.5C18.1 4.5 10 12.6 10 22.5C10 23.3 10.1 24 10.2 24.8C5.2 26.2 1.5 30.8 1.5 36.2C1.5 41.6 5.9 46 11.3 46H16Z" fill="none" stroke="currentColor" stroke-width="4" stroke-linejoin="round"/></svg>`,
            rain: `<svg class="weather-svg" viewBox="${viewboxSetting}"><path d="M16 40H48C55.7 40 62 33.7 62 26C62 18.3 55.7 12 48 12C47.1 12 46.2 12.1 45.4 12.3C43.5 4.4 36.4 -1.5 28 -1.5C18.1 -1.5 10 6.6 10 16.5C10 17.3 10.1 18 10.2 18.8C5.2 20.2 1.5 24.8 1.5 30.2C1.5 35.6 5.9 40 11.3 40H16Z" fill="none" stroke="currentColor" stroke-width="4"/><path d="M22 48L18 58 M32 48L28 58 M42 48L38 58" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg>`,
            snow: `<svg class="weather-svg" viewBox="${viewboxSetting}"><path d="M32 12V52 M14 22L50 42 M14 42L50 22" stroke="currentColor" stroke-width="4" stroke-linecap="round"/><circle cx="32" cy="32" r="2" fill="currentColor"/></svg>`,
            thunder: `<svg class="weather-svg" viewBox="${viewboxSetting}"><path d="M16 40H48C55.7 40 62 33.7 62 26C62 18.3 55.7 12 48 12C47.1 12 46.2 12.1 45.4 12.3C43.5 4.4 36.4 -1.5 28 -1.5C18.1 -1.5 10 6.6 10 16.5C10 17.3 10.1 18 10.2 18.8C5.2 20.2 1.5 24.8 1.5 30.2C1.5 35.6 5.9 40 11.3 40H16Z" fill="none" stroke="currentColor" stroke-width="4"/><path d="M34 38L26 50H36L30 62" stroke="currentColor" stroke-width="4" stroke-linejoin="round"/></svg>`
        };

        function getWeatherDetails(code) {
            if (code === 0) return { text: "Clear Sky", icon: icons.sun };
            if (code <= 3) return { text: "Cloudy", icon: icons.cloud };
            if (code <= 48) return { text: "Fog", icon: icons.cloud };
            if (code <= 67) return { text: "Rain", icon: icons.rain };
            if (code <= 77) return { text: "Snow", icon: icons.snow };
            if (code <= 82) return { text: "Showers", icon: icons.rain };
            if (code <= 99) return { text: "Thunderstorm", icon: icons.thunder };
            return { text: "Unknown", icon: icons.cloud };
        }

        async function fetchWeather() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                const daily = data.daily;
                const todayMax = Math.round(daily.temperature_2m_max[0]);
                const todayMin = Math.round(daily.temperature_2m_min[0]);
                const weatherCode = daily.weathercode[0];

                const details = getWeatherDetails(weatherCode);

                document.getElementById('weather-icon').innerHTML = details.icon;
                document.getElementById('temp-max').textContent = todayMax + "°";
                document.getElementById('temp-min').textContent = todayMin + "°";
                document.getElementById('weather-text').textContent = details.text;
                
            } catch (e) {
                console.error("Weather fetch failed", e);
                document.getElementById('weather-text').textContent = "Offline";
            }
        }

        setupManifest();
        setInterval(updateClock, 30);
        updateClock();
        fetchWeather();
        setInterval(fetchWeather, 1800000); 
    </script>
</body>
</html>
